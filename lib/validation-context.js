"use strict";

var _extends = function (child, parent) {
  child.prototype = Object.create(parent.prototype, {
    constructor: {
      value: child,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  child.__proto__ = parent;
};

var keyword = require("esutils").keyword;
var isRestrictedWord = keyword.isRestrictedWord;
var isReservedWordES5 = keyword.isReservedWordES5;
var ValidationContext = (function () {
  var ValidationContext = function ValidationContext(freeBreakStatements, freeContinueStatements, usedLabelNames, freeJumpTargets, freeReturnStatements, errors, strictErrors) {
    this.freeBreakStatements = freeBreakStatements;
    this.freeContinueStatements = freeContinueStatements;
    this.usedLabelNames = usedLabelNames;
    this.freeJumpTargets = freeJumpTargets;
    this.freeReturnStatements = freeReturnStatements;
    this.errors = errors;
    this.strictErrors = strictErrors;
  };

  ValidationContext.empty = function () {
    return new ValidationContext([], [], [], [], [], [], []);
  };

  ValidationContext.prototype.addFreeBreakStatement = function (s) {
    return new ValidationContext(this.freeBreakStatements.concat([s]), this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearFreeBreakStatements = function () {
    return new ValidationContext([], this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeContinueStatement = function (s) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements.concat([s]), this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearFreeContinueStatements = function () {
    return new ValidationContext(this.freeBreakStatements, [], this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.observeLabelName = function (l) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames.concat([l.name]), this.freeJumpTargets.filter(function (identifier) {
      return identifier.name !== l.name;
    }), this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearUsedLabelNames = function () {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, [], this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeJumpTarget = function (l) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets.concat([l]), this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeReturnStatement = function (r) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements.concat([r]), this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearFreeReturnStatements = function () {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, [], this.errors, this.strictErrors);
  };

  ValidationContext.prototype.checkReserved = function (identifier) {
    if (isReservedWordES5(identifier.name, true)) {
      if (isReservedWordES5(identifier.name, false)) {
        return this.addError(new ValidationError(identifier, "Identifier must not be reserved word in this position"));
      }
      return this.addStrictError(new ValidationError(identifier, "Identifier must not be strict mode reserved word in this position"));
    }
    return this;
  };

  ValidationContext.prototype.checkRestricted = function (identifier) {
    var v = this.checkReserved(identifier);
    if (isRestrictedWord(identifier.name)) {
      return v.addStrictError(new ValidationError(identifier, "Identifier must not be restricted word in this position in strict mode"));
    }
    return v;
  };

  ValidationContext.prototype.addError = function (e) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors.concat([e]), this.strictErrors);
  };

  ValidationContext.prototype.addErrors = function (errors) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors.concat(errors), this.strictErrors);
  };

  ValidationContext.prototype.addStrictError = function (e) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors.concat([e]));
  };

  ValidationContext.prototype.concat = function (v) {
    return new ValidationContext(this.freeBreakStatements.concat(v.freeBreakStatements), this.freeContinueStatements.concat(v.freeContinueStatements), this.usedLabelNames.concat(v.usedLabelNames), this.freeJumpTargets.concat(v.freeJumpTargets), this.freeReturnStatements.concat(v.freeReturnStatements), this.errors.concat(v.errors), this.strictErrors.concat(v.strictErrors));
  };

  return ValidationContext;
})();

exports.ValidationContext = ValidationContext;
var ValidationError = (function (Error) {
  var ValidationError = function ValidationError(node, message) {
    this.node = node;
    this.message = message;
  };

  _extends(ValidationError, Error);

  return ValidationError;
})(Error);

exports.ValidationError = ValidationError;
//# sourceMappingURL=data:application/json;base64,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QyxFQUFFO0FBQ1IsV0FBTyxJQUFJLGlCQUFpQixDQUMxQixJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxFQUN0RCxJQUFJLENBQUMsc0JBQXNCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxzQkFBc0IsQ0FBQyxFQUM1RCxJQUFJLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLEVBQzVDLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxlQUFlLENBQUMsRUFDOUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsb0JBQW9CLENBQUMsRUFDeEQsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUM1QixJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQ3pDLENBQUM7R0FDSDs7U0E1TFUsaUJBQWlCOzs7UUFBakIsaUJBQWlCLEdBQWpCLGlCQUFpQjtJQStMakIsZUFBZSxjQUFTLEtBQUs7TUFBN0IsZUFBZSxHQUNmLFNBREEsZUFBZSxDQUNkLElBQUksRUFBRSxPQUFPLEVBQUU7QUFDekIsUUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7QUFDakIsUUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7R0FDeEI7O1dBSlUsZUFBZSxFQUFTLEtBQUs7O1NBQTdCLGVBQWU7R0FBUyxLQUFLOztRQUE3QixlQUFlLEdBQWYsZUFBZSIsImZpbGUiOiJzcmMvdmFsaWRhdGlvbi1jb250ZXh0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgMjAxNCBTaGFwZSBTZWN1cml0eSwgSW5jLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIilcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7a2V5d29yZH0gZnJvbSBcImVzdXRpbHNcIjtcbmNvbnN0IHtpc1Jlc3RyaWN0ZWRXb3JkLCBpc1Jlc2VydmVkV29yZEVTNX0gPSBrZXl3b3JkO1xuXG5leHBvcnQgY2xhc3MgVmFsaWRhdGlvbkNvbnRleHQge1xuXG4gIGNvbnN0cnVjdG9yKGZyZWVCcmVha1N0YXRlbWVudHMsIGZyZWVDb250aW51ZVN0YXRlbWVudHMsIHVzZWRMYWJlbE5hbWVzLCBmcmVlSnVtcFRhcmdldHMsIGZyZWVSZXR1cm5TdGF0ZW1lbnRzLCBlcnJvcnMsIHN0cmljdEVycm9ycykge1xuICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyA9IGZyZWVCcmVha1N0YXRlbWVudHM7XG4gICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzID0gZnJlZUNvbnRpbnVlU3RhdGVtZW50cztcbiAgICB0aGlzLnVzZWRMYWJlbE5hbWVzID0gdXNlZExhYmVsTmFtZXM7XG4gICAgdGhpcy5mcmVlSnVtcFRhcmdldHMgPSBmcmVlSnVtcFRhcmdldHM7XG4gICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyA9IGZyZWVSZXR1cm5TdGF0ZW1lbnRzO1xuICAgIHRoaXMuZXJyb3JzID0gZXJyb3JzO1xuICAgIHRoaXMuc3RyaWN0RXJyb3JzID0gc3RyaWN0RXJyb3JzO1xuICB9XG5cbiAgc3RhdGljIGVtcHR5KCkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoW10sW10sW10sW10sW10sW10sW10pO1xuICB9XG5cbiAgYWRkRnJlZUJyZWFrU3RhdGVtZW50KHMpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLmNvbmNhdChbc10pLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcyxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZXJyb3JzLFxuICAgICAgdGhpcy5zdHJpY3RFcnJvcnNcbiAgICApO1xuICB9XG5cbiAgY2xlYXJGcmVlQnJlYWtTdGF0ZW1lbnRzKCkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICBbXSxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGFkZEZyZWVDb250aW51ZVN0YXRlbWVudChzKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cy5jb25jYXQoW3NdKSxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGNsZWFyRnJlZUNvbnRpbnVlU3RhdGVtZW50cygpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLFxuICAgICAgW10sXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBvYnNlcnZlTGFiZWxOYW1lKGwpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcy5jb25jYXQoW2wubmFtZV0pLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMuZmlsdGVyKGlkZW50aWZpZXIgPT4gaWRlbnRpZmllci5uYW1lICE9PSBsLm5hbWUpLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZXJyb3JzLFxuICAgICAgdGhpcy5zdHJpY3RFcnJvcnNcbiAgICApO1xuICB9XG5cbiAgY2xlYXJVc2VkTGFiZWxOYW1lcygpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgW10sXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGFkZEZyZWVKdW1wVGFyZ2V0KGwpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcyxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLmNvbmNhdChbbF0pLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZXJyb3JzLFxuICAgICAgdGhpcy5zdHJpY3RFcnJvcnNcbiAgICApO1xuICB9XG5cbiAgYWRkRnJlZVJldHVyblN0YXRlbWVudChyKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMuY29uY2F0KFtyXSksXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGNsZWFyRnJlZVJldHVyblN0YXRlbWVudHMoKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIFtdLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBjaGVja1Jlc2VydmVkKGlkZW50aWZpZXIpIHtcbiAgICBpZiAoaXNSZXNlcnZlZFdvcmRFUzUoaWRlbnRpZmllci5uYW1lLCB0cnVlKSkge1xuICAgICAgaWYgKGlzUmVzZXJ2ZWRXb3JkRVM1KGlkZW50aWZpZXIubmFtZSwgZmFsc2UpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZEVycm9yKG5ldyBWYWxpZGF0aW9uRXJyb3IoaWRlbnRpZmllciwgXCJJZGVudGlmaWVyIG11c3Qgbm90IGJlIHJlc2VydmVkIHdvcmQgaW4gdGhpcyBwb3NpdGlvblwiKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5hZGRTdHJpY3RFcnJvcihuZXcgVmFsaWRhdGlvbkVycm9yKGlkZW50aWZpZXIsIFwiSWRlbnRpZmllciBtdXN0IG5vdCBiZSBzdHJpY3QgbW9kZSByZXNlcnZlZCB3b3JkIGluIHRoaXMgcG9zaXRpb25cIikpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNoZWNrUmVzdHJpY3RlZChpZGVudGlmaWVyKSB7XG4gICAgbGV0IHYgPSB0aGlzLmNoZWNrUmVzZXJ2ZWQoaWRlbnRpZmllcik7XG4gICAgaWYgKGlzUmVzdHJpY3RlZFdvcmQoaWRlbnRpZmllci5uYW1lKSkge1xuICAgICAgcmV0dXJuIHYuYWRkU3RyaWN0RXJyb3IobmV3IFZhbGlkYXRpb25FcnJvcihpZGVudGlmaWVyLCBcIklkZW50aWZpZXIgbXVzdCBub3QgYmUgcmVzdHJpY3RlZCB3b3JkIGluIHRoaXMgcG9zaXRpb24gaW4gc3RyaWN0IG1vZGVcIikpO1xuICAgIH1cbiAgICByZXR1cm4gdjtcbiAgfVxuXG4gIGFkZEVycm9yKGUpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcyxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZXJyb3JzLmNvbmNhdChbZV0pLFxuICAgICAgdGhpcy5zdHJpY3RFcnJvcnNcbiAgICApO1xuICB9XG5cbiAgYWRkRXJyb3JzKGVycm9ycykge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5lcnJvcnMuY29uY2F0KGVycm9ycyksXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBhZGRTdHJpY3RFcnJvcihlKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzLmNvbmNhdChbZV0pXG4gICAgKTtcbiAgfVxuXG4gIGNvbmNhdCh2KSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dCAoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMuY29uY2F0KHYuZnJlZUJyZWFrU3RhdGVtZW50cyksXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMuY29uY2F0KHYuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyksXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLmNvbmNhdCh2LnVzZWRMYWJlbE5hbWVzKSxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLmNvbmNhdCh2LmZyZWVKdW1wVGFyZ2V0cyksXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLmNvbmNhdCh2LmZyZWVSZXR1cm5TdGF0ZW1lbnRzKSxcbiAgICAgIHRoaXMuZXJyb3JzLmNvbmNhdCh2LmVycm9ycyksXG4gICAgICB0aGlzLnN0cmljdEVycm9ycy5jb25jYXQodi5zdHJpY3RFcnJvcnMpXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgVmFsaWRhdGlvbkVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3Rvcihub2RlLCBtZXNzYWdlKSB7XG4gICAgdGhpcy5ub2RlID0gbm9kZTtcbiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICB9XG59XG4iXX0=