"use strict";

var _extends = function (child, parent) {
  child.prototype = Object.create(parent.prototype, {
    constructor: {
      value: child,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  child.__proto__ = parent;
};

var keyword = require("esutils").keyword;
var isRestrictedWord = keyword.isRestrictedWord;
var isReservedWordES5 = keyword.isReservedWordES5;
var ValidationContext = (function () {
  var ValidationContext = function ValidationContext(freeBreakStatements, freeContinueStatements, usedLabelNames, freeJumpTargets, freeReturnStatements, errors, strictErrors) {
    this.freeBreakStatements = freeBreakStatements;
    this.freeContinueStatements = freeContinueStatements;
    this.usedLabelNames = usedLabelNames;
    this.freeJumpTargets = freeJumpTargets;
    this.freeReturnStatements = freeReturnStatements;
    this.errors = errors;
    this.strictErrors = strictErrors;
  };

  ValidationContext.empty = function () {
    return new ValidationContext([], [], [], [], [], [], []);
  };

  ValidationContext.prototype.addFreeBreakStatement = function (s) {
    return new ValidationContext(this.freeBreakStatements.concat([s]), this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearFreeBreakStatements = function () {
    return new ValidationContext([], this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeContinueStatement = function (s) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements.concat([s]), this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearFreeContinueStatements = function () {
    return new ValidationContext(this.freeBreakStatements, [], this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.observeIterationLabelName = function (label) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames.concat([label.name]), this.freeJumpTargets.filter(function (info) {
      return info.name !== label.name;
    }), this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.observeNonIterationLabelName = function (label) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames.concat([label.name]), this.freeJumpTargets.filter(function (info) {
      return info.name !== label.name || info.type !== "break";
    }), this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearUsedLabelNames = function () {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, [], this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeBreakJumpTarget = function (label) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets.concat([{ name: label.name, type: "break" }]), this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeContinueJumpTarget = function (label) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets.concat([{ name: label.name, type: "continue" }]), this.freeReturnStatements, this.errors, this.strictErrors);
  };

  ValidationContext.prototype.addFreeReturnStatement = function (r) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements.concat([r]), this.errors, this.strictErrors);
  };

  ValidationContext.prototype.clearFreeReturnStatements = function () {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, [], this.errors, this.strictErrors);
  };

  ValidationContext.prototype.checkReserved = function (identifier) {
    if (isReservedWordES5(identifier.name, true)) {
      if (isReservedWordES5(identifier.name, false)) {
        return this.addError(new ValidationError(identifier, "Identifier must not be reserved word in this position"));
      }
      return this.addStrictError(new ValidationError(identifier, "Identifier must not be strict mode reserved word in this position"));
    }
    return this;
  };

  ValidationContext.prototype.checkRestricted = function (identifier) {
    var v = this.checkReserved(identifier);
    if (isRestrictedWord(identifier.name)) {
      return v.addStrictError(new ValidationError(identifier, "Identifier must not be restricted word in this position in strict mode"));
    }
    return v;
  };

  ValidationContext.prototype.addError = function (e) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors.concat([e]), this.strictErrors);
  };

  ValidationContext.prototype.addErrors = function (errors) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors.concat(errors), this.strictErrors);
  };

  ValidationContext.prototype.addStrictError = function (e) {
    return new ValidationContext(this.freeBreakStatements, this.freeContinueStatements, this.usedLabelNames, this.freeJumpTargets, this.freeReturnStatements, this.errors, this.strictErrors.concat([e]));
  };

  ValidationContext.prototype.concat = function (v) {
    return new ValidationContext(this.freeBreakStatements.concat(v.freeBreakStatements), this.freeContinueStatements.concat(v.freeContinueStatements), this.usedLabelNames.concat(v.usedLabelNames), this.freeJumpTargets.concat(v.freeJumpTargets), this.freeReturnStatements.concat(v.freeReturnStatements), this.errors.concat(v.errors), this.strictErrors.concat(v.strictErrors));
  };

  return ValidationContext;
})();

exports.ValidationContext = ValidationContext;
var ValidationError = (function (Error) {
  var ValidationError = function ValidationError(node, message) {
    this.node = node;
    this.message = message;
  };

  _extends(ValidationError, Error);

  return ValidationError;
})(Error);

exports.ValidationError = ValidationError;
//# sourceMappingURL=data:application/json;base64,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c0JBQXNCLENBQUMsRUFDNUQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxFQUM1QyxJQUFJLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLEVBQzlDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLEVBQ3hELElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFDNUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUN6QyxDQUFDO0dBQ0g7O1NBck5VLGlCQUFpQjs7O1FBQWpCLGlCQUFpQixHQUFqQixpQkFBaUI7SUF3TmpCLGVBQWUsY0FBUyxLQUFLO01BQTdCLGVBQWUsR0FDZixTQURBLGVBQWUsQ0FDZCxJQUFJLEVBQUUsT0FBTyxFQUFFO0FBQ3pCLFFBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0FBQ2pCLFFBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0dBQ3hCOztXQUpVLGVBQWUsRUFBUyxLQUFLOztTQUE3QixlQUFlO0dBQVMsS0FBSzs7UUFBN0IsZUFBZSxHQUFmLGVBQWUiLCJmaWxlIjoic3JjL3ZhbGlkYXRpb24tY29udGV4dC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IDIwMTQgU2hhcGUgU2VjdXJpdHksIEluYy5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpXG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge2tleXdvcmR9IGZyb20gXCJlc3V0aWxzXCI7XG5jb25zdCB7aXNSZXN0cmljdGVkV29yZCwgaXNSZXNlcnZlZFdvcmRFUzV9ID0ga2V5d29yZDtcblxuZXhwb3J0IGNsYXNzIFZhbGlkYXRpb25Db250ZXh0IHtcblxuICBjb25zdHJ1Y3RvcihmcmVlQnJlYWtTdGF0ZW1lbnRzLCBmcmVlQ29udGludWVTdGF0ZW1lbnRzLCB1c2VkTGFiZWxOYW1lcywgZnJlZUp1bXBUYXJnZXRzLCBmcmVlUmV0dXJuU3RhdGVtZW50cywgZXJyb3JzLCBzdHJpY3RFcnJvcnMpIHtcbiAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMgPSBmcmVlQnJlYWtTdGF0ZW1lbnRzO1xuICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyA9IGZyZWVDb250aW51ZVN0YXRlbWVudHM7XG4gICAgdGhpcy51c2VkTGFiZWxOYW1lcyA9IHVzZWRMYWJlbE5hbWVzO1xuICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzID0gZnJlZUp1bXBUYXJnZXRzO1xuICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMgPSBmcmVlUmV0dXJuU3RhdGVtZW50cztcbiAgICB0aGlzLmVycm9ycyA9IGVycm9ycztcbiAgICB0aGlzLnN0cmljdEVycm9ycyA9IHN0cmljdEVycm9ycztcbiAgfVxuXG4gIHN0YXRpYyBlbXB0eSgpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFtdLFtdLFtdLFtdLFtdLFtdLFtdKTtcbiAgfVxuXG4gIGFkZEZyZWVCcmVha1N0YXRlbWVudChzKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cy5jb25jYXQoW3NdKSxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGNsZWFyRnJlZUJyZWFrU3RhdGVtZW50cygpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgW10sXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBhZGRGcmVlQ29udGludWVTdGF0ZW1lbnQocykge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMuY29uY2F0KFtzXSksXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBjbGVhckZyZWVDb250aW51ZVN0YXRlbWVudHMoKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIFtdLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcyxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZXJyb3JzLFxuICAgICAgdGhpcy5zdHJpY3RFcnJvcnNcbiAgICApO1xuICB9XG5cbiAgb2JzZXJ2ZUl0ZXJhdGlvbkxhYmVsTmFtZShsYWJlbCkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLmNvbmNhdChbbGFiZWwubmFtZV0pLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMuZmlsdGVyKGluZm8gPT4gaW5mby5uYW1lICE9PSBsYWJlbC5uYW1lKSxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIG9ic2VydmVOb25JdGVyYXRpb25MYWJlbE5hbWUobGFiZWwpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcy5jb25jYXQoW2xhYmVsLm5hbWVdKSxcbiAgICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMuZmlsdGVyKGluZm8gPT4gaW5mby5uYW1lICE9PSBsYWJlbC5uYW1lIHx8IGluZm8udHlwZSAhPT0gJ2JyZWFrJyksXG4gICAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICAgIHRoaXMuZXJyb3JzLFxuICAgICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBjbGVhclVzZWRMYWJlbE5hbWVzKCkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICBbXSxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZXJyb3JzLFxuICAgICAgdGhpcy5zdHJpY3RFcnJvcnNcbiAgICApO1xuICB9XG5cbiAgYWRkRnJlZUJyZWFrSnVtcFRhcmdldChsYWJlbCkge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMuY29uY2F0KFt7bmFtZTogbGFiZWwubmFtZSwgdHlwZTogJ2JyZWFrJ31dKSxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGFkZEZyZWVDb250aW51ZUp1bXBUYXJnZXQobGFiZWwpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcyxcbiAgICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMuY29uY2F0KFt7bmFtZTogbGFiZWwubmFtZSwgdHlwZTogJ2NvbnRpbnVlJ31dKSxcbiAgICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG5cbiAgYWRkRnJlZVJldHVyblN0YXRlbWVudChyKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMuY29uY2F0KFtyXSksXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzXG4gICAgKTtcbiAgfVxuXG4gIGNsZWFyRnJlZVJldHVyblN0YXRlbWVudHMoKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIFtdLFxuICAgICAgdGhpcy5lcnJvcnMsXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBjaGVja1Jlc2VydmVkKGlkZW50aWZpZXIpIHtcbiAgICBpZiAoaXNSZXNlcnZlZFdvcmRFUzUoaWRlbnRpZmllci5uYW1lLCB0cnVlKSkge1xuICAgICAgaWYgKGlzUmVzZXJ2ZWRXb3JkRVM1KGlkZW50aWZpZXIubmFtZSwgZmFsc2UpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFkZEVycm9yKG5ldyBWYWxpZGF0aW9uRXJyb3IoaWRlbnRpZmllciwgXCJJZGVudGlmaWVyIG11c3Qgbm90IGJlIHJlc2VydmVkIHdvcmQgaW4gdGhpcyBwb3NpdGlvblwiKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5hZGRTdHJpY3RFcnJvcihuZXcgVmFsaWRhdGlvbkVycm9yKGlkZW50aWZpZXIsIFwiSWRlbnRpZmllciBtdXN0IG5vdCBiZSBzdHJpY3QgbW9kZSByZXNlcnZlZCB3b3JkIGluIHRoaXMgcG9zaXRpb25cIikpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNoZWNrUmVzdHJpY3RlZChpZGVudGlmaWVyKSB7XG4gICAgbGV0IHYgPSB0aGlzLmNoZWNrUmVzZXJ2ZWQoaWRlbnRpZmllcik7XG4gICAgaWYgKGlzUmVzdHJpY3RlZFdvcmQoaWRlbnRpZmllci5uYW1lKSkge1xuICAgICAgcmV0dXJuIHYuYWRkU3RyaWN0RXJyb3IobmV3IFZhbGlkYXRpb25FcnJvcihpZGVudGlmaWVyLCBcIklkZW50aWZpZXIgbXVzdCBub3QgYmUgcmVzdHJpY3RlZCB3b3JkIGluIHRoaXMgcG9zaXRpb24gaW4gc3RyaWN0IG1vZGVcIikpO1xuICAgIH1cbiAgICByZXR1cm4gdjtcbiAgfVxuXG4gIGFkZEVycm9yKGUpIHtcbiAgICByZXR1cm4gbmV3IFZhbGlkYXRpb25Db250ZXh0KFxuICAgICAgdGhpcy5mcmVlQnJlYWtTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5mcmVlQ29udGludWVTdGF0ZW1lbnRzLFxuICAgICAgdGhpcy51c2VkTGFiZWxOYW1lcyxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLFxuICAgICAgdGhpcy5mcmVlUmV0dXJuU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZXJyb3JzLmNvbmNhdChbZV0pLFxuICAgICAgdGhpcy5zdHJpY3RFcnJvcnNcbiAgICApO1xuICB9XG5cbiAgYWRkRXJyb3JzKGVycm9ycykge1xuICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbkNvbnRleHQoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMsXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMsXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLFxuICAgICAgdGhpcy5mcmVlSnVtcFRhcmdldHMsXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLFxuICAgICAgdGhpcy5lcnJvcnMuY29uY2F0KGVycm9ycyksXG4gICAgICB0aGlzLnN0cmljdEVycm9yc1xuICAgICk7XG4gIH1cblxuICBhZGRTdHJpY3RFcnJvcihlKSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dChcbiAgICAgIHRoaXMuZnJlZUJyZWFrU3RhdGVtZW50cyxcbiAgICAgIHRoaXMuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyxcbiAgICAgIHRoaXMudXNlZExhYmVsTmFtZXMsXG4gICAgICB0aGlzLmZyZWVKdW1wVGFyZ2V0cyxcbiAgICAgIHRoaXMuZnJlZVJldHVyblN0YXRlbWVudHMsXG4gICAgICB0aGlzLmVycm9ycyxcbiAgICAgIHRoaXMuc3RyaWN0RXJyb3JzLmNvbmNhdChbZV0pXG4gICAgKTtcbiAgfVxuXG4gIGNvbmNhdCh2KSB7XG4gICAgcmV0dXJuIG5ldyBWYWxpZGF0aW9uQ29udGV4dCAoXG4gICAgICB0aGlzLmZyZWVCcmVha1N0YXRlbWVudHMuY29uY2F0KHYuZnJlZUJyZWFrU3RhdGVtZW50cyksXG4gICAgICB0aGlzLmZyZWVDb250aW51ZVN0YXRlbWVudHMuY29uY2F0KHYuZnJlZUNvbnRpbnVlU3RhdGVtZW50cyksXG4gICAgICB0aGlzLnVzZWRMYWJlbE5hbWVzLmNvbmNhdCh2LnVzZWRMYWJlbE5hbWVzKSxcbiAgICAgIHRoaXMuZnJlZUp1bXBUYXJnZXRzLmNvbmNhdCh2LmZyZWVKdW1wVGFyZ2V0cyksXG4gICAgICB0aGlzLmZyZWVSZXR1cm5TdGF0ZW1lbnRzLmNvbmNhdCh2LmZyZWVSZXR1cm5TdGF0ZW1lbnRzKSxcbiAgICAgIHRoaXMuZXJyb3JzLmNvbmNhdCh2LmVycm9ycyksXG4gICAgICB0aGlzLnN0cmljdEVycm9ycy5jb25jYXQodi5zdHJpY3RFcnJvcnMpXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgVmFsaWRhdGlvbkVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3Rvcihub2RlLCBtZXNzYWdlKSB7XG4gICAgdGhpcy5ub2RlID0gbm9kZTtcbiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlO1xuICB9XG59XG4iXX0=